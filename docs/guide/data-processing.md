# 数据处理

Industry Vis 内置多种数据处理功能，可在分组详情页中配置和使用。

## 处理流程

数据处理按以下顺序执行：

```
原始数据 → 异常值剔除 → 重采样 → 平滑滤波 → 降采样 → 显示
```

## 异常值剔除

使用 **3σ 法则**（三倍标准差法则）识别和移除异常值。

### 原理

对于正态分布的数据，约 99.7% 的数据点落在 μ±3σ 范围内。超出此范围的数据点被视为异常值。

```
下界 = μ - 3σ
上界 = μ + 3σ
```

### 适用场景

- 传感器误读
- 通信错误导致的异常值
- 设备故障产生的脉冲

### 配置

在分组详情页勾选 **异常值剔除**，系统将自动移除超出范围的数据点。

## 时间序列重采样

将高频数据聚合到指定的时间间隔，使用**均值聚合**方式。

### 配置参数

| 参数 | 说明 | 范围 |
|------|------|------|
| 间隔 | 重采样时间间隔 | 1-3600 秒 |

### 示例

原始数据（1秒采样）：
```
00:00:01 → 10.5
00:00:02 → 10.8
00:00:03 → 10.2
...
00:00:59 → 10.6
00:01:00 → 10.4
```

重采样（60秒间隔）后：
```
00:00:00 → 10.5 (00:00:00-00:00:59 的平均值)
00:01:00 → 10.4 (00:01:00-00:01:59 的平均值)
```

### 适用场景

- 查看长时间趋势
- 减少数据量
- 消除高频噪声

## 平滑滤波

使用**移动平均**算法平滑数据曲线。

### 配置参数

| 参数 | 说明 | 范围 |
|------|------|------|
| 窗口 | 滑动窗口大小 | 2-50 点 |

### 算法

对于每个数据点，取其前后各 `窗口/2` 个点的平均值：

```
smoothed[i] = mean(data[i - window/2 : i + window/2 + 1])
```

### 适用场景

- 消除随机噪声
- 使趋势更清晰
- 数据预处理

## 自动降采样

当数据量超过阈值时，系统自动进行均匀降采样，避免前端渲染卡顿。

### 默认配置

- 每个标签最多显示 **5000** 个数据点
- 超出时均匀抽取

### 算法

```
step = total_points / max_points
保留 index % step == 0 的点
```

## 配置持久化

数据处理配置会随分组一起保存。下次打开分组时，自动加载上次的配置。

配置保存在 `tag_groups.toml` 文件中：

```toml
[[groups]]
id = "g1234567890"
name = "温度监控"
tags = ["Tag1", "Tag2"]
created_at = "2024-01-01T00:00:00"
updated_at = "2024-01-01T00:00:00"

[groups.processing_config]
[groups.processing_config.outlier_removal]
enabled = true
method = "3sigma"

[groups.processing_config.resample]
enabled = true
interval = 60
method = "mean"

[groups.processing_config.smoothing]
enabled = false
method = "moving_avg"
window = 5
```

## 使用建议

| 场景 | 推荐配置 |
|------|---------|
| 实时监控 | 不启用处理，保持原始数据 |
| 班次分析 | 启用重采样（60秒），可选平滑 |
| 趋势分析 | 启用重采样（300秒）+ 平滑（窗口5） |
| 异常诊断 | 启用异常值剔除，不使用平滑 |
